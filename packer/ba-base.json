{
	"variables": {
		"aws_access_key": "{{env `PACKER_AWS_ACCESS_KEY_ID`}}",
		"aws_secret_key": "{{env `PACKER_SECRET_ACCESS_KEY`}}",
        "bucket_access_key": "{{env `AWS_ACCESS_KEY_ID`}}",
        "bucket_secret_key": "{{env `AWS_SECRET_ACCESS_KEY`}}",
		"vpc_id"		: "{{env `PACKER_VPC_ID`}}",
		"subnet_id"		: "{{env `PACKER_SUBNET_ID`}}",
		"s3_bucket"		: "{{env `PACKER_S3_BUCKET`}}",
		"aws_region"	: "us-east-1",
		"source_ami"	: "ami-fce3c696"
	},
	"builders": [{
        "type"							: "amazon-ebs",
	    "access_key"					: "{{user `aws_access_key`}}",
	    "secret_key"					: "{{user `aws_secret_key`}}",
	    "region"						: "{{user `aws_region`}}",
	    "associate_public_ip_address"	: "True",
	    "source_ami"					: "{{user `source_ami`}}",
	    "instance_type"					: "m3.medium",
	    "ssh_username"					: "ubuntu",
	    "ami_name"						: "ba-base_ubuntu14.04__{{timestamp}}",
        "vpc_id"                        : "{{user `vpc_id`}}",
        "subnet_id"                     : "{{user `subnet_id`}}"
	}],
	"provisioners": [
		{
			"type"				: "shell",
			"script"			: "provision.sh",
			"environment_vars"	: [
				"AWS_ACCESS_KEY_ID={{user `bucket_access_key`}}",
				"AWS_SECRET_ACCESS_KEY={{user `bucket_secret_key`}}",
				"AWS_REGION={{user `aws_region`}}",
				"SECRET_BUCKET={{user `s3_bucket`}}"
			]
		},
  		{
		    "type"					: "chef-client",
		    "server_url"			: "https://api.chef.io/organizations/blueapron",
		    "validation_client_name": "blueapron-validator",
            "run_list"              : ["ba_base", "datadog"],
            "chef_environment"      : "ba-packer-base",
            "json"                  : {
                "ba": {
                    "logstash": {
                        "host": "ec2-52-32-51-234.us-west-2.compute.amazonaws.com:5044",
                        "ca_location": "/etc/logstash-forwarder.crt",
                        "aws": {
                            "key": "logstash-forwarder.crt",
                            "bucket": "infrastructure.blueapron.com",
                            "access_key": "AKIAIA6P6TWH7PVEFVLQ",
                            "secret_access_key": "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"
                        }
                    }
                }
            }
		}
	]
}
