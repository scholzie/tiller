{
	"variables": {
		"aws_access_key": "{{env `PACKER_AWS_ACCESS_KEY_ID`}}",
		"aws_secret_key": "{{env `PACKER_SECRET_ACCESS_KEY`}}",
		"vpc_id"		: "{{env `PACKER_VPC_ID`}}",
		"subnet_id"		: "{{env `PACKER_SUBNET_ID`}}",
		"s3_bucket"		: "{{env `PACKER_S3_BUCKET`}}",
		"aws_region"	: "us-east-1",
		"source_ami"	: "ami-fce3c696"
	},
	"builders": [{
		"type"							: "amazon-ebs",
	    "access_key"					: "{{user `aws_access_key`}}",
	    "secret_key"					: "{{user `aws_secret_key`}}",
	    "region"						: "{{user `aws_region`}}",
	    "associate_public_ip_address"	: "True",
	    "source_ami"					: "{{user `source_ami`}}",
	    "instance_type"					: "m3.medium",
	    "ssh_username"					: "ubuntu",
	    "ami_name"						: "ba-base_ubuntu14.04__{{timestamp}}",
	    // May not even need this to make a base image. I switched instance_type to m3, which can run in ec2-classic
	    //"subnet_id": "{{user `subnet_id`}}",
	    //"vpc_id": "{{user `vpc_id`}}"
	}],
	"provisioners": [
		{
			"type"				:"shell",
			"script"			: "provision.sh",
			"environment_vars"	: [
				"AWS_ACCESS_KEY_ID={{user `aws_access_key`}}",
				"AWS_SECRET_ACCESS_KEY={{user `aws_secret_key`}}",
				"AWS_REGION={{user `aws_region`}}",
				"SECRET_BUCKET={{user `s3_bucket`}}"
			],
			"execute_command"	: "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
		},
  		{
		    "type"					: "chef-client",
		    "server_url"			: "https://api.chef.io/organizations/blueapron",
		    "validation_client_name": "blueapron-validator",
		    "chef_environment"		: "ba-packer-base",
		}
	]
}